# -----------------------
# 1. Берём официальный Python 3.12-slim
# -----------------------
FROM python:3.12-slim

# -----------------------
# 2. Рабочая директория
# -----------------------
WORKDIR /app

# -----------------------
# 3. Копируем только dependencies для кеша
# -----------------------
COPY requirements.txt .

# -----------------------
# 4. Устанавливаем зависимости
# -----------------------
RUN pip install --no-cache-dir -r requirements.txt

# -----------------------
# 5. Копируем весь остальной код
# -----------------------
COPY . .

# -----------------------
# 6. Копируем entrypoint и даём права на исполнение
# -----------------------
COPY entrypoint.sh .
RUN chmod +x entrypoint.sh

# -----------------------
# 7. По умолчанию запускаем entrypoint
# -----------------------
ENTRYPOINT ["./entrypoint.sh"]
