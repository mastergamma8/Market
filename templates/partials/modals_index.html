<!-- –ü–æ–∏—Å–∫ —Ç–æ–∫–µ–Ω–∞ -->
<div class="modal fade" id="tokenSearchModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <form onsubmit="return redirectToToken(event);">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">–ù–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <input type="text" id="tokenNumberInput" class="form-control" placeholder="1234" required>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary">–ò—Å–∫–∞—Ç—å</button>
          <button class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- –û—à–∏–±–∫–∞ -->
<div class="modal fade" id="errorModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">–û—à–∏–±–∫–∞</h5></div>
      <div class="modal-body">–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.</div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏—Å—Ç–∏–Ω–≥–∞ -->
{% for listing in market %}
  <div class="modal fade" id="listingModal-{{ listing.token.token }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header token-details">
          <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ {{ listing.token.token }}</h5>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-3">
            <div class="modal-token-card lazy-bg"
                 data-bg-src="{{ listing.token.bg_color }}"
                 style="color:{{ listing.token.text_color }};
                        {% if listing.token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}">
              <h4>{{ listing.token.token }}</h4>
            </div>
          </div>
          <p><strong>–†–µ–¥–∫–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞:</strong> {{ listing.token.number_rarity }}</p>
          <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ü–∏—Ñ—Ä:</strong> {{ listing.token.text_rarity }}</p>
          <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞:</strong> {{ listing.token.bg_rarity }}</p>
          <p><strong>–û–±—â–∞—è:</strong> {{ listing.token.overall_rarity }}</p>
          <p><strong>–¶–µ–Ω–∞:</strong> {{ listing.price }} üíé</p>
          <p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> {{ users.get(listing.seller_id,{}).get('username',listing.seller_id) }}</p>
        </div>
        <div class="modal-footer">
          {% if user_id==listing.seller_id %}
            <button class="btn btn-warning" data-toggle="modal"
                    data-target="#updatePriceModal-{{ listing.token.token }}">–ò–∑–º. —Ü–µ–Ω—É</button>
            <form action="/withdraw" method="post"><button class="btn btn-danger">–°–Ω—è—Ç—å</button></form>
          {% else %}
            <form action="/buy/{{ listing.token.token }}" method="post"><button class="btn btn-primary">–ö—É–ø–∏—Ç—å</button></form>
            <button class="btn btn-info" data-toggle="modal"
                    data-target="#offerModal-{{ listing.token.token }}">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å</button>
          {% endif %}
          <button class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä.</button>
        </div>
      </div>
    </div>
  </div>

  {% if user_id==listing.seller_id %}
    <!-- Update price -->
    <div class="modal fade" id="updatePriceModal-{{ listing.token.token }}" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <form action="/updateprice" method="post">
          <div class="modal-content">
            <div class="modal-header token-details">
              <h5 class="modal-title">–ù–æ–≤–∞—è —Ü–µ–Ω–∞ {{ listing.token.token }}</h5>
              <button class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
              <input type="hidden" name="market_index" value="{{ listing.token.token }}">
              <input type="number" name="new_price" class="form-control" required>
            </div>
            <div class="modal-footer">
              <button class="btn btn-warning">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
              <button class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  {% endif %}

  <!-- Offer -->
  <div class="modal fade" id="offerModal-{{ listing.token.token }}" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <form action="/offer" method="post">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å {{ listing.token.token }}</h5>
            <button class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <input type="hidden" name="token_value" value="{{ listing.token.token }}">
            <input type="number" name="proposed_price" class="form-control" required>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </form>
    </div>
  </div>
{% endfor %}
