{# templates/index.html #}
{% import 'macros_index.html' as macros %}

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>TTH NFT</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/CSS/index.css">
</head>
<body>
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
    {% if user %}
      <span class="navbar-brand balance-box">üíé {{ user.balance|default(0) }}</span>
    {% else %}
      <a class="navbar-brand" href="/">TTH NFT</a>
    {% endif %}
    <div class="ml-auto d-flex align-items-center">
      {% if user %}
        <a href="/profile/{{ user_id }}" class="mr-3">
          {% if user.photo_url.endswith('.mp4') or user.photo_url[-3:]|lower == 'gif' %}
            <video class="profile-avatar" autoplay loop muted playsinline>
              <source src="{{ user.photo_url }}" type="video/mp4">
            </video>
          {% else %}
            <img src="{{ user.photo_url }}" alt="Avatar" class="profile-avatar">
          {% endif %}
        </a>
        <a href="/logout" class="btn btn-sm btn-outline-danger mr-2">–í—ã–π—Ç–∏</a>
      {% else %}
        <a href="/login" class="btn btn-sm btn-outline-primary mr-2">–í–æ–π—Ç–∏</a>
      {% endif %}
      <button class="btn btn-link p-0 mr-2" data-toggle="modal" data-target="#tokenSearchModal" title="–ù–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω">
        <img src="/static/butons/lupa.png" alt="–ü–æ–∏—Å–∫" class="icon-30">
      </button>
    </div>
  </nav>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
  <div class="content">
    <div class="container my-4">

      <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
      <div class="row main-buttons justify-content-center flex-nowrap">
        <div class="col-auto text-center">
          <a href="/mint" class="btn-icon">
            <img src="/static/butons/create.png"><small>–°–æ–∑–¥–∞—Ç—å<br>–Ω–æ–º–µ—Ä</small>
          </a>
        </div>
        <div class="col-auto text-center">
          <a href="/sell" class="btn-icon">
            <img src="/static/butons/sell.png"><small>–ü—Ä–æ–¥–∞—Ç—å<br>–Ω–æ–º–µ—Ä</small>
          </a>
        </div>
        <div class="col-auto text-center">
          <a href="/auctions" class="btn-icon">
            <img src="/static/butons/auction.png"><small>–ê—É–∫—Ü–∏–æ–Ω</small>
          </a>
        </div>
        <div class="col-auto text-center">
          <a href="/exchange" class="btn-icon">
            <img src="/static/butons/exchange.png"><small>–û–±–º–µ–Ω<br>–Ω–æ–º–µ—Ä–∞–º–∏</small>
          </a>
        </div>
        <div class="col-auto text-center">
          <a href="/transfer" class="btn-icon">
            <img src="/static/butons/transfer.png"><small>–ü–µ—Ä–µ–¥–∞—Ç—å<br>–Ω–æ–º–µ—Ä</small>
          </a>
        </div>
        <div class="col-auto text-center">
          <a href="/participants" class="btn-icon">
            <img src="/static/butons/liderboard.png"><small>–°–ø–∏—Å–æ–∫ –ª–∏–¥–µ—Ä–æ–≤</small>
          </a>
        </div>
        <div class="col-auto text-center">
          <a href="/assets" class="btn-icon">
            <img src="/static/butons/activity.png"><small>–ê–∫—Ç–∏–≤—ã</small>
          </a>
        </div>
      </div>

      <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
      <div class="sort-container">
        <button id="toggle-sort" class="btn btn-secondary btn-block">
          –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å <span id="sort-arrow">&#9660;</span>
        </button>
        <div id="sort-options" class="mt-2">
          <div class="sort-options-rows">
            <div class="row">
              <div class="btn-group btn-group-sm">
                <button class="btn sort-btn" data-sort="token-length-asc">–ú–µ–Ω—å—à–µ —Ü–∏—Ñ—Ä</button>
                <button class="btn sort-btn" data-sort="repeats-desc">–ë–æ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä–æ–≤</button>
                <button class="btn sort-btn" data-sort="bg-rarity-asc">–†–µ–¥–∫–∏–µ —Ñ–æ–Ω—ã</button>
              </div>
            </div>
            <div class="row mt-2">
              <div class="btn-group btn-group-sm">
                <button class="btn sort-btn" data-sort="price-asc">–¶–µ–Ω–∞‚¨á</button>
                <button class="btn sort-btn" data-sort="price-desc">–¶–µ–Ω–∞‚¨Ü</button>
              </div>
            </div>
          </div>
          <div class="mt-2">
            <label>–§–∏–ª—å—Ç—Ä –ø–æ —Ñ–æ–Ω—É:</label>
            <div id="custom-bg-filter">
              <div class="selected">
                <div class="color-circle" style="background:#fff"></div><span>–í—Å–µ —Ü–≤–µ—Ç–∞</span>
              </div>
              <ul></ul>
            </div>
          </div>
        </div>
      </div>

      {% if user %}
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <ul class="nav nav-tabs" id="numbersTab">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#sale-numbers">–ù–∞ –ø—Ä–æ–¥–∞–∂–µ</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#my-numbers">–ú–æ–∏ –Ω–æ–º–µ—Ä–∞</a>
          </li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane fade show active" id="sale-numbers">
            <h1 class="mb-4">–ù–æ–º–µ—Ä–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ</h1>
            <div class="row">
              {% for listing in market %}
                {{ macros.market_card(listing, users) }}
              {% endfor %}
            </div>
          </div>
          <div class="tab-pane fade" id="my-numbers">
            <h1 class="mb-4">–ú–æ–∏ –Ω–æ–º–µ—Ä–∞</h1>
            <div class="row">
              {% set my_listings = market | selectattr("seller_id","equalto",user_id)|list %}
              {% if my_listings %}
                {% for listing in my_listings %}
                  {{ macros.market_card(listing, users) }}
                {% endfor %}
              {% else %}
                <div class="col-12"><p>–£ –≤–∞—Å –Ω–µ—Ç –Ω–æ–º–µ—Ä–æ–≤ –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ.</p></div>
              {% endif %}
            </div>
          </div>
        </div>
      {% else %}
        <h1 class="mb-4">–ù–æ–º–µ—Ä–∞ –Ω–∞ –ø—Ä–æ–¥–∞–∂–µ</h1>
        <div class="row">
          {% for listing in market %}
            {{ macros.market_card(listing, users) }}
          {% endfor %}
        </div>
      {% endif %}

      {# –ú–æ–¥–∞–ª–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ª–∏—Å—Ç–∏–Ω–≥–∞ #}
      {% for listing in market %}
        {{ macros.listing_modal(listing, users, user, user_id, buyer_id) }}
      {% endfor %}

      {# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ #}
      {% include 'partials/modals_index.html' %}

      <button id="scrollToTopBtn">&#8593;</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <script src="/static/js/index.js"></script>
</body>
</html>
