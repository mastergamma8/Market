<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%; overflow: hidden; margin: 0; padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }
    .fixed-header {
      position: fixed; top: 0; left: 0; width: 100%; height: 70px;
      background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 10px; z-index: 1000;
    }
    .fixed-header h1 { font-size: 1.5rem; margin: 0; }
    .content {
      position: absolute; top: 80px; left: 0; right: 0; bottom: 0;
      overflow-y: auto; padding: 10px 20px;
    }
    .create-card {
      border: none; border-radius: 15px; padding: 20px; margin: 40px auto;
      width: 280px; height: 120px;
      display: flex; align-items: center; justify-content: center;
      font-size: 3rem; color: #999;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer; transition: transform .3s, box-shadow .3s;
    }
    .create-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .stats-card {
      background: #fff; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      padding: 1.5rem; margin-top: 1.5rem;
    }
    .stats-card h5 { font-weight: 500; margin-bottom: .5rem; }
    .stats-card .h3 { font-size: 2rem; font-weight: 700; }
    .btn-home { max-height: 40px; }
  </style>
</head>
<body>
  <div class="container-fluid fixed-header d-flex justify-content-between align-items-center">
    <a href="/"><img src="/static/butons/home.png" alt="–ù–∞ –≥–ª–∞–≤–Ω—É—é" class="btn-home"></a>
    <h1 class="mb-0 text-center flex-grow-1">–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</h1>
    <div style="width:50px;"></div>
  </div>

  <div class="content">
    {% if error %}
      <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
    <div class="create-card" data-toggle="modal" data-target="#createModal">+</div>

    <!-- –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–ø–æ—Å–ª–µ –∫–∞—Ä—Ç–æ—á–∫–∏) -->
    <div class="stats-card">
      <div class="row text-center mb-4">
        <div class="col">
          <h5>–°–æ–∑–¥–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</h5>
          <p class="h3">{{ today_created or 0 }}</p>
        </div>
        <div class="col">
          <h5>–í–∞—à–∏—Ö –≤—Å–µ–≥–æ</h5>
          <p class="h3">{{ total_created or 0 }}</p>
        </div>
        <div class="col">
          <h5>–í—Å–µ–≥–æ –ø–æ —Å–µ—Ä–≤–∏—Å—É</h5>
          <p class="h3">{{ global_created or 0 }}</p>
        </div>
        {% if best_token %}
        <div class="col">
          <h5>–í–∞—à —Ç–æ–ø-—Ç–æ–∫–µ–Ω</h5>
          <div class="token-card mx-auto" style="width:60px; height:60px; display:flex; align-items:center; justify-content:center;">
            <span style="color: {{ best_token.text_color }}; font-size:1.5rem;">{{ best_token.token }}</span>
          </div>
        </div>
        {% endif %}
      </div>

      {% if recent_tokens %}
      <h5 class="text-center mb-3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–º–µ—Ä–∞</h5>
      <div class="d-flex justify-content-center flex-wrap">
        {% for t in recent_tokens %}
        <div class="token-card m-2" style="width:50px; height:50px; font-size:1.2rem; display:flex; align-items:center; justify-content:center;">
          <span style="color: {{ t.text_color }};">{{ t.token }}</span>
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius:15px;">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä</h5>
            <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
          </div>
          <div class="text-center">
            <img src="/static/butons/tutorial.gif" alt="Tutorial" class="img-fluid">
          </div>
          <div class="modal-body">
            {% if attempts_left > 0 %}
              <p>–£ –≤–∞—Å –µ—Å—Ç—å <strong>{{ attempts_left }}</strong> –±–µ—Å–ø–ª–∞—Ç–Ω(–∞—è/—ã—Ö) –ø–æ–ø—ã—Ç(–∫–∞/–æ–∫) –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.</p>
              <p>–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            {% else %}
              <p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã.</p>
              <p>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞ <strong>100</strong> üíé.<br>–ë–∞–ª–∞–Ω—Å: <strong>{{ balance }}</strong> üíé.</p>
            {% endif %}
          </div>
          <div class="modal-footer">
            <form action="/mint" method="post">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              {% if attempts_left > 0 %}
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
              {% else %}
                <button type="submit" class="btn btn-success" {% if balance < 100 %}disabled{% endif %}>
                  –°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé
                </button>
              {% endif %}
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS Bootstrap –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
