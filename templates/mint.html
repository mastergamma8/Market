<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</title>
  
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Google Fonts: Noto Sans JP –∏ Lato -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">

  <style>
    /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É, –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π —Å–∫—Ä–æ–ª–ª */
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (fixed header) */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      height: 70px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 10px;
    }
    .fixed-header h1 {
      font-size: 1.5rem;
      margin: 0;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º */
    .content {
      position: absolute;
      top: 80px; /* –æ—Ç—Å—Ç—É–ø –ø–æ–¥ —à–∞–ø–∫—É */
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      padding: 10px 20px;
    }

    /* –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏ "—Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä" */
    .create-card {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin: 40px auto;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
      width: 280px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: #999;
      z-index: 1;
    }
    .create-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    /* –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å –≤–∏–¥–µ–æ–±—ç–∫–≥—Ä–∞—É–Ω–¥–æ–º */
    #animationOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1050;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.4);
    }
    /* –í–∏–¥–µ–æ-–±—ç–∫–≥—Ä–∞—É–Ω–¥ */
    #animationVideo {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      transform: translate(-50%, -50%);
      z-index: 0;
      object-fit: cover;
    }
    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–≤–µ—Ä—Ö –≤–∏–¥–µ–æ */
    #animationCard {
      position: relative;
      z-index: 1;
      border-radius: 15px;
      width: 280px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>
  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <div class="container-fluid fixed-header d-flex justify-content-between align-items-center">
    <a href="/">
      <img src="/static/butons/home.png" alt="–ù–∞ –≥–ª–∞–≤–Ω—É—é" class="btn-home">
    </a>
    <h1 class="mb-0 text-center flex-grow-1">–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</h1>
    <div style="width:50px;"></div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="content">
    {% if error %}
      <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
    <div class="create-card" data-toggle="modal" data-target="#createModal">
      +
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–ø–æ—Å–æ–±–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog"
         aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius: 15px;">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="text-center">
            <img src="/static/butons/tutorial.gif" alt="Tutorial" class="img-fluid">
          </div>
          <div class="modal-body">
            {% if attempts_left > 0 %}
              <p>–£ –≤–∞—Å –µ—Å—Ç—å <strong>{{ attempts_left }}</strong> –±–µ—Å–ø–ª–∞—Ç–Ω(–∞—è/—ã—Ö) –ø–æ–ø—ã—Ç(–∫–∞/–æ–∫) –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.</p>
              <p>–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            {% else %}
              <p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã.</p>
              <p>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞ <strong>100</strong> üíé.<br>
                 –í–∞—à –±–∞–ª–∞–Ω—Å: <strong>{{ balance }}</strong> üíé.</p>
            {% endif %}
          </div>
          <div class="modal-footer">
            <form action="/mint" method="post" style="margin-bottom: 0;">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              {% if attempts_left > 0 %}
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
              {% else %}
                <button type="submit" class="btn btn-success" {% if balance < 100 %}disabled{% endif %}>
                  –°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé
                </button>
              {% endif %}
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
  <div id="animationOverlay">
    <!-- –í–∏–¥–µ–æ-–±—ç–∫–≥—Ä–∞—É–Ω–¥ -->
    <video id="animationVideo" autoplay muted loop>
      <source src="/static/video/background.mp4" type="video/mp4">
    </video>
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
    <div class="create-card" id="animationCard"></div>
  </div>

  <!-- Bootstrap JS –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (jQuery, Popper) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  
  <!-- –°–∫—Ä–∏–ø—Ç –∞–Ω–∏–º–∞—Ü–∏–∏ -->
  <script>
    $(document).ready(function(){
      // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã (–ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å")
      $("form[action='/mint']").on("submit", function(e){
        e.preventDefault();
        var form = this;
        $("#createModal").modal('hide');
        $("#animationOverlay").css("display", "flex");

        // –ò—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞)
        var finalToken = "{{ final_token }}";       // –ò—Ç–æ–≥–æ–≤–æ–µ —á–∏—Å–ª–æ/–Ω–æ–º–µ—Ä
        var finalText = "{{ final_text }}";         // –ò—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç)
        var finalBg   = "{{ final_bg }}";           // –ò—Ç–æ–≥–æ–≤—ã–π —Ñ–æ–Ω (–≥—Ä–∞–¥–∏–µ–Ω—Ç, —Å–ø–ª–æ—à–Ω–æ–π —Ü–≤–µ—Ç –∏–ª–∏ –ø—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é)

        var animationDuration = 2500; // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ –º—Å
        var startTime = Date.now();

        var animInterval = setInterval(function(){
          // –ü–æ–∫–∞ –Ω–µ –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –∏ —Å—Ç–∏–ª–∏
          var randLength = Math.floor(Math.random() * 4) + 3;
          var randomNum = "";
          for(var i = 0; i < randLength; i++){
            randomNum += Math.floor(Math.random() * 10);
          }
          $("#animationCard").text(randomNum);

          // –î–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
          var randomBg = (Math.random() < 0.5)
                        ? "linear-gradient(45deg, #00e4ff, #58ffca, #00ff24)"
                        : "#"+Math.floor(Math.random()*16777215).toString(16);
          var randomText = (Math.random() < 0.5)
                        ? "linear-gradient(45deg, #ff4500, #ffa500, #adff2f)"
                        : "#"+Math.floor(Math.random()*16777215).toString(16);
          
          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–æ–Ω
          $("#animationCard").css('background', randomBg);
          
          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞ (–µ—Å–ª–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç ‚Äì –≤–∫–ª—é—á–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç)
          if(randomText.indexOf("linear-gradient") === 0){
            $("#animationCard").css({
              'background-clip': 'text',
              '-webkit-background-clip': 'text',
              'color': 'transparent'
            });
          } else {
            $("#animationCard").css({
              'color': randomText,
              'background-clip': 'initial'
            });
          }
          
          // –ï—Å–ª–∏ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—Ç–µ–∫–ª–æ ‚Äì —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ —Å—Ç–∏–ª–∏
          if(Date.now() - startTime > animationDuration){
            clearInterval(animInterval);
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –Ω–æ–º–µ—Ä
            $("#animationCard").text(finalToken);
            // –ï—Å–ª–∏ –∏—Ç–æ–≥–æ–≤—ã–π —Ñ–æ–Ω ‚Äì –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å /static/image/)
            if(finalBg.indexOf("/static/image/") === 0){
              $("#animationCard").css({
                'background': 'url(' + finalBg + ') no-repeat center center',
                'background-size': 'cover'
              });
            } else {
              $("#animationCard").css('background', finalBg);
            }
            // –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞)
            if(finalText.indexOf("linear-gradient") === 0){
              $("#animationCard").css({
                'background-clip': 'text',
                '-webkit-background-clip': 'text',
                'color': 'transparent'
              });
            } else {
              $("#animationCard").css({
                'color': finalText,
                'background-clip': 'initial'
              });
            }
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 600 –º—Å)
            setTimeout(function(){
              $(form).off("submit");
              form.submit();
            }, 600);
          }
        }, 80);
      });
    });
  </script>
</body>
</html>
