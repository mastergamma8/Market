<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</title>
  
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Google Fonts: Noto Sans JP –∏ Lato -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">

  <style>
    /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É, –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π —Å–∫—Ä–æ–ª–ª */
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (fixed header) */
    .fixed-header {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 70px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 10px;
      z-index: 1000;
    }
    .fixed-header h1 {
      font-size: 1.5rem;
      margin: 0;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º */
    .content {
      position: absolute;
      top: 80px; bottom: 0;
      left: 0; right: 0;
      overflow-y: auto;
      padding: 10px 20px;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ "–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä" */
    .create-card {
      position: relative;
      width: 280px; height: 140px;
      margin: 0 auto;
      border: none;
      border-radius: 15px;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform .3s, box-shadow .3s;
    }
    .create-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .create-card .plus-sign {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3rem;
      line-height: 1;
      color: #999;
    }
    .create-card .create-text {
      position: absolute;
      bottom: 12px; left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem;
      color: #666;
      white-space: nowrap;
    }

    /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞ */
    .section-title {
      white-space: nowrap;
      font-size: 1.5rem;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ */
    .market-card {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
      cursor: pointer;
      transition: transform .3s, box-shadow .3s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .market-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    .market-number {
      font-family: 'Lato', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0;
    }
    .rarity-badge {
      position: absolute;
      top: 10px; right: 10px;
      background-color: #ff9800;
      color: #fff;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* –ú–µ–¥–∏–∞–∑–∞–ø—Ä–æ—Å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 576px) {
      .create-card .create-text { font-size: 0.8rem; }
      .section-title           { font-size: 1.2rem; }
      .market-number           { font-size: 2rem; }
    }

    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –º–æ–¥–∞–ª–æ–∫ (–∫–∞–∫ –≤ –ø—Ä–æ—Ñ–∏–ª–µ) */
    .modal-content {
      border-radius: 15px;
      border: none;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal-header, .modal-footer {
      border: none;
    }
    .modal-header.token-details {
      padding-bottom: 0;
    }
    .modal-token-card {
      padding: 40px !important;
      border: none !important;
      box-shadow: none !important;
      background: inherit !important;
    }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
    .alert { margin-top: 20px; }
    .btn-home { max-height: 40px; }
  </style>
</head>
<body>

  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ -->
  <div class="container-fluid fixed-header d-flex justify-content-between align-items-center">
    <a href="/"><img src="/static/butons/home.png" alt="–ù–∞ –≥–ª–∞–≤–Ω—É—é" class="btn-home"></a>
    <h1 class="mb-0 text-center flex-grow-1">–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</h1>
    <div style="width:50px;"></div>
  </div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="content">
    {% if error %}
      <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
    <div class="create-card" data-toggle="modal" data-target="#createModal">
      <div class="plus-sign">+</div>
      <div class="create-text">–ù–∞–∂–º–∏—Ç–µ –∑–¥–µ—Å—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è NFT –Ω–æ–º–µ—Ä–∞</div>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ -->
    <h2 class="text-center my-4 section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</h2>
    <div class="row">
      {% for token in recent_tokens %}
        <div class="col-md-6">
          <div class="market-card"
               data-token="{{ token.token }}"
               data-token-length="{{ token.token|length }}"
               data-repeats="{{ token.max_repeats }}"
               data-bg-rarity="{{ token.bg_rarity[:-1]|float }}"
               data-bg-color="{{ token.bg_color }}"
               {% if token.bg_is_image %}
                 style="background: url('{{ token.bg_color }}') no-repeat center/cover; color: {{ token.text_color }};"
               {% elif 'linear-gradient' in token.bg_color %}
                 style="background: {{ token.bg_color }}; color: {{ token.text_color }};"
               {% else %}
                 style="background-color: {{ token.bg_color }}; color: {{ token.text_color }};"
               {% endif %}
               data-toggle="modal" data-target="#tokenModal-{{ token.token }}">
            
            {% if token.overall_rarity != '–û–±—ã—á–Ω—ã–π' %}
              <div class="rarity-badge">{{ token.overall_rarity }}</div>
            {% endif %}
            
            <div class="market-number">
              {% if 'linear-gradient' in token.text_color %}
                <span style="
                  background: {{ token.text_color }};
                  -webkit-background-clip: text; color: transparent;">
                  {{ token.token }}
                </span>
              {% else %}
                {{ token.token }}
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog"
         aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius:15px;">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä</h5>
            <button type="button" class="close" data-dismiss="modal">
              <span>&times;</span>
            </button>
          </div>
          <div class="text-center">
            <img src="/static/butons/tutorial.gif" alt="Tutorial" class="img-fluid">
          </div>
          <div class="modal-body">
            {% if attempts_left > 0 %}
              <p>–£ –≤–∞—Å –µ—Å—Ç—å <strong>{{ attempts_left }}</strong> –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.</p>
              <p>–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            {% else %}
              <p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã.</p>
              <p>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞ <strong>100</strong> üíé.<br>–í–∞—à –±–∞–ª–∞–Ω—Å: <strong>{{ balance }}</strong> üíé.</p>
            {% endif %}
          </div>
          <div class="modal-footer">
            <form action="/mint" method="post" style="margin-bottom:0;">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              {% if attempts_left > 0 %}
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
              {% else %}
                <button type="submit" class="btn btn-success" {% if balance < 100 %}disabled{% endif %}>
                  –°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé
                </button>
              {% endif %}
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–∫–µ–Ω–æ–≤ -->
    {% for token in recent_tokens %}
      <div class="modal fade" id="tokenModal-{{ token.token }}" tabindex="-1" role="dialog"
           aria-labelledby="tokenModalLabel-{{ token.token }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header token-details"
                 {% if token.bg_is_image %}
                   style="background: url('{{ token.bg_color }}') no-repeat center/cover;"
                 {% elif 'linear-gradient' in token.bg_color %}
                   style="background: {{ token.bg_color }};"
                 {% else %}
                   style="background-color: {{ token.bg_color }};"
                 {% endif %}>
              <h5 class="modal-title" id="tokenModalLabel-{{ token.token }}">–î–µ—Ç–∞–ª–∏ –Ω–æ–º–µ—Ä–∞ {{ token.token }}</h5>
              <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            </div>
            <div class="modal-body text-center">
              <div class="token-card modal-token-card"
                   {% if token.bg_is_image %}
                     style="background: url('{{ token.bg_color }}') no-repeat center/cover; {% if token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}"
                   {% elif 'linear-gradient' in token.bg_color %}
                     style="background: {{ token.bg_color }}; {% if token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}"
                   {% else %}
                     style="background-color: {{ token.bg_color }}; {% if token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}"
                   {% endif %}>
                <h4 class="token-number">
                  {% if 'linear-gradient' in token.text_color %}
                    <span style="
                      background: {{ token.text_color }};
                      -webkit-background-clip: text; color: transparent;">
                      {{ token.token }}
                    </span>
                  {% else %}
                    <span style="color: {{ token.text_color }};">{{ token.token }}</span>
                  {% endif %}
                </h4>
              </div>
              <div class="mt-3 text-left">
                <p><strong>–†–µ–¥–∫–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞:</strong> {{ token.number_rarity }}</p>
                <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ü–∏—Ñ—Ä:</strong> {{ token.text_rarity }}</p>
                <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞:</strong> {{ token.bg_rarity }}</p>
                <p><strong>–û–±—â–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å:</strong> {{ token.overall_rarity }}</p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}

  </div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã Bootstrap –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
