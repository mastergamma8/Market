<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <!-- –ó–∞–ø—Ä–µ—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no">
  <title>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</title>
  
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Google Fonts: Noto Sans JP –∏ Lato -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">

  <style>
    /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É, –æ—Ç–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π —Å–∫—Ä–æ–ª–ª */
    html, body {
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (fixed header) */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      height: 70px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 10px;
    }
    .fixed-header h1 {
      font-size: 1.5rem;
      margin: 0;
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–∫—Ä–æ–ª–ª–æ–º */
    .content {
      position: absolute;
      top: 80px; /* –æ—Ç—Å—Ç—É–ø –ø–æ–¥ —à–∞–ø–∫—É */
      left: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      padding: 10px 20px;
    }

    /* –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏ "—Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä" (–±–µ—Ä—ë–º –∏–¥–µ–∏ –∏–∑ token-card) */
    .create-card {
      border: none;
      border-radius: 15px;
      padding: 20px;
      margin: 40px auto;
      text-align: center;
      cursor: pointer;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(0,0,0,0.1));
      width: 280px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      color: #999;
    }
    .create-card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
    .alert {
      margin-top: 20px;
    }
    .btn-home {
      max-height: 40px;
    }

    /* –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç */
    #animationOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1050;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <div class="container-fluid fixed-header d-flex justify-content-between align-items-center">
    <a href="/">
      <img src="/static/butons/home.png" alt="–ù–∞ –≥–ª–∞–≤–Ω—É—é" class="btn-home">
    </a>
    <h1 class="mb-0 text-center flex-grow-1">–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä</h1>
    <div style="width:50px;"></div> <!-- –ü—É—Å—Ç—ã—à–∫–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è -->
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <div class="content">
    <!-- –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∞ -->
    {% if error %}
      <div class="alert alert-danger text-center">{{ error }}</div>
    {% endif %}

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
    <!-- –ü—Ä–∏ –∫–ª–∏–∫–µ —Å data-toggle="modal" –∏ data-target="#createModal" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div class="create-card" data-toggle="modal" data-target="#createModal">
      +
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—ã–±–æ—Ä–æ–º —Å–ø–æ—Å–æ–±–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
    <div class="modal fade" id="createModal" tabindex="-1" role="dialog"
         aria-labelledby="createModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius: 15px;">
          <div class="modal-header">
            <h5 class="modal-title" id="createModalLabel">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          
          <!-- –í—Å—Ç–∞–≤–ª—è–µ–º GIF –º–µ–∂–¥—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
          <div class="text-center">
            <img src="/static/butons/tutorial.gif" alt="Tutorial" class="img-fluid">
          </div>
          
          <div class="modal-body">
            {% if attempts_left > 0 %}
              <p>–£ –≤–∞—Å –µ—Å—Ç—å <strong>{{ attempts_left }}</strong> –±–µ—Å–ø–ª–∞—Ç–Ω(–∞—è/—ã—Ö) –ø–æ–ø—ã—Ç(–∫–∞/–æ–∫) –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.</p>
              <p>–ú–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            {% else %}
              <p>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã.</p>
              <p>–°–æ–∑–¥–∞—Ç—å –Ω–æ–º–µ—Ä –∑–∞ <strong>100</strong> üíé.<br>
                 –í–∞—à –±–∞–ª–∞–Ω—Å: <strong>{{ balance }}</strong> üíé.</p>
            {% endif %}
          </div>
          <div class="modal-footer">
            <form action="/mint" method="post" style="margin-bottom: 0;">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              {% if attempts_left > 0 %}
                <!-- –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ" -->
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ</button>
              {% else %}
                <!-- –ö–Ω–æ–ø–∫–∞ "–°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé" -->
                <button type="submit" class="btn btn-success"
                        {% if balance < 100 %}disabled{% endif %}>
                  –°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé
                </button>
              {% endif %}
            </form>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –û–≤–µ—Ä–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ -->
  <div id="animationOverlay">
    <div class="create-card" id="animationCard" style="width:280px; height:120px;"></div>
  </div>

  <!-- Bootstrap JS –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (jQuery, Popper) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  
  <!-- –°–∫—Ä–∏–ø—Ç –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã -->
  <script>
    $(document).ready(function(){
      // –¢–µ–ø–µ—Ä—å –Ω–µ —É–¥–∞–ª—è–µ–º data-–∞—Ç—Ä–∏–±—É—Ç—ã, —á—Ç–æ–±—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –æ—Ç–∫—Ä—ã–≤–∞–ª–æ—Å—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ

      // –ú–∞—Å—Å–∏–≤ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è —Ü–≤–µ—Ç–∞ —Ü–∏—Ñ—Ä (–∞–Ω–∞–ª–æ–≥ —Ñ—É–Ω–∫—Ü–∏–∏ generate_text_attributes)
      var textVariants = [
        "#FFFFFF", "#000000",
        "linear-gradient(45deg, #00c2e6, #48d9af, #00cc1f)",
        "linear-gradient(45deg, #0099ff, #00ccff, #00ffcc)",
        "linear-gradient(45deg, #00bfff, #00f5ff, #00ff99)",
        "linear-gradient(45deg, #1e3c72, #2a5298, #1e90ff)",
        "linear-gradient(45deg, #3a1c71, #d76d77, #ffaf7b)",
        "linear-gradient(45deg, #134E5E, #71B280, #B2F4B8)",
        "linear-gradient(45deg, #e60000, #e6b800, #66cc00)",
        "linear-gradient(45deg, #FF4500, #FFA500, #ADFF2F)",
        "linear-gradient(45deg, #FF6347, #FFD700, #98FB98)",
        "linear-gradient(45deg, #B22222, #FF8C00, #9ACD32)",
        "linear-gradient(45deg, #DC143C, #FFD700, #32CD32)",
        "linear-gradient(45deg, #8B0000, #FFA07A, #90EE90)",
        "linear-gradient(45deg, #8E44AD, #3498DB, #2ECC71)",
        "linear-gradient(45deg, #9932CC, #00BFFF, #3CB371)",
        "linear-gradient(45deg, #8A2BE2, #1E90FF, #32CD32)",
        "linear-gradient(45deg, #6A0DAD, #4169E1, #3CB371)",
        "linear-gradient(45deg, #9400D3, #00CED1, #2E8B57)",
        "linear-gradient(45deg, #800080, #0000FF, #008000)",
        "#FF5733", "#33FFCE", "#FFD700", "#FF69B4", "#00FA9A",
        "#8e44ad", "#2c3e50", "#DC143C", "#20B2AA", "#FFDAB9",
        "#d35400", "#e67e22", "#27ae60", "#FF7F50", "#4682B4", "#9ACD32"
      ];

      // –ú–∞—Å—Å–∏–≤ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è —Ñ–æ–Ω–∞: –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã, —Å–ø–ª–æ—à–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∏ –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
      var bgVariants = [
        "linear-gradient(45deg, #00e4ff, #58ffca, #00ff24)",
        "linear-gradient(45deg, #00bfff, #66ffe0, #00ff88)",
        "linear-gradient(45deg, #0099ff, #33ccff, #66ffcc)",
        "linear-gradient(45deg, #0F2027, #203A43, #2C5364)",
        "linear-gradient(45deg, #3E5151, #DECBA4, #F4E2D8)",
        "linear-gradient(45deg, #1D4350, #A43931, #E96443)",
        "linear-gradient(45deg, #ff0000, #ffd358, #82ff00)",
        "linear-gradient(45deg, #FF1493, #00CED1, #FFD700)",
        "linear-gradient(45deg, #FF69B4, #40E0D0, #FFFACD)",
        "linear-gradient(45deg, #B22222, #FF8C00, #9ACD32)",
        "linear-gradient(45deg, #DC143C, #FFD700, #32CD32)",
        "linear-gradient(45deg, #8B0000, #FFA07A, #90EE90)",
        "linear-gradient(45deg, #FFC0CB, #FF69B4, #FF1493)",
        "linear-gradient(45deg, #FFB6C1, #FF69B4, #FF4500)",
        "linear-gradient(45deg, #FF69B4, #FF1493, #C71585)",
        "linear-gradient(45deg, #FFB347, #FFCC33, #FFD700)",
        "linear-gradient(45deg, #F7971E, #FFD200, #FF9A00)",
        "linear-gradient(45deg, #FF7E5F, #FEB47B, #FFDAB9)",
        "#f1c40f", "#1abc9c", "#FF4500", "#32CD32", "#87CEEB",
        "#2ecc71", "#3498db", "#FF8C00", "#6A5ACD", "#40E0D0",
        "#9b59b6", "#34495e", "#808000", "#FFD700", "#FF69B4", "#00CED1",
        "/static/image/pepemint.png",
        "/static/image/pepecarton.png",
        "/static/image/ton.png"
      ];

      // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã (–Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ" –∏–ª–∏ "–°–æ–∑–¥–∞—Ç—å –∑–∞ 100 üíé")
      $("form[action='/mint']").on("submit", function(e){
        e.preventDefault();
        var form = this;
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        $("#createModal").modal('hide');
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º display:flex
        $("#animationOverlay").css("display", "flex");

        var animationDuration = 2500; // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ –º—Å
        var startTime = Date.now();

        var animInterval = setInterval(function(){
          // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ (–æ—Ç 3 –¥–æ 6 —Ü–∏—Ñ—Ä)
          var randLength = Math.floor(Math.random() * 4) + 3;
          var randomNum = "";
          for(var i = 0; i < randLength; i++){
            randomNum += Math.floor(Math.random() * 10);
          }
          $("#animationCard").text(randomNum);
          
          // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ñ–æ–Ω–∞ –∏ —Ü–≤–µ—Ç–∞
          var randomBg = bgVariants[Math.floor(Math.random() * bgVariants.length)];
          var randomText = textVariants[Math.floor(Math.random() * textVariants.length)];
          
          // –ï—Å–ª–∏ —Ñ–æ–Ω ‚Äì –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ /static/image/
          if(randomBg.indexOf("/static/image/") === 0){
            $("#animationCard").css({
              'background': 'url(' + randomBg + ') no-repeat center center',
              'background-size': 'cover'
            });
          } else {
            $("#animationCard").css('background', randomBg);
          }
          
          // –ï—Å–ª–∏ —Ü–≤–µ—Ç ‚Äì –≥—Ä–∞–¥–∏–µ–Ω—Ç, –ø—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
          if(randomText.indexOf("linear-gradient") === 0){
            $("#animationCard").css({
              'background-clip': 'text',
              '-webkit-background-clip': 'text',
              'color': 'transparent'
            });
          } else {
            $("#animationCard").css({
              'color': randomText,
              'background-clip': 'initial'
            });
          }
          
          // –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ ‚Äì –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
          if(Date.now() - startTime > animationDuration){
            clearInterval(animInterval);
            // –û—Ç–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª–∞—Å—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
            $(form).off("submit");
            form.submit();
          }
        }, 80);
      });
    });
  </script>
</body>
</html>
