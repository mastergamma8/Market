<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ê—É–∫—Ü–∏–æ–Ω TTH NFT</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background: #f5f7fa;
      font-family: Arial, sans-serif;
    }
    .auction-card {
      max-width: 500px;
      margin: 50px auto;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-radius: 10px;
      background: #fff;
    }
    .timer {
      font-size: 2rem;
      font-weight: bold;
      color: #ff5722;
    }
  </style>
</head>
<body>
  <div class="auction-card text-center">
    <h2>–ê—É–∫—Ü–∏–æ–Ω</h2>
    <p id="token-info">–¢–æ–∫–µ–Ω: <span id="auction-token">-</span></p>
    <p>–¢–µ–∫—É—â–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: <span id="highest-bid">0</span> üíé</p>
    <p>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="highest-bidder">-</span></p>
    <p>–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <span class="timer" id="time-remaining">0</span> —Å–µ–∫—É–Ω–¥</p>
    <hr>
    <form id="bid-form">
      <div class="form-group">
        <label for="bid-username">–í–∞—à–µ –∏–º—è:</label>
        <input type="text" class="form-control" id="bid-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
      </div>
      <div class="form-group">
        <label for="bid-amount">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (üíé):</label>
        <input type="number" class="form-control" id="bid-amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É" required>
      </div>
      <button type="submit" class="btn btn-primary">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
    </form>
    <div id="bid-message" class="mt-3"></div>
  </div>

  <!-- jQuery –∏ Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞—É–∫—Ü–∏–æ–Ω–∞
    function updateAuctionStatus(){
      $.ajax({
        url: '/auction_status',
        method: 'GET',
        success: function(data) {
          if(data.active){
            $('#auction-token').text(data.token);
            $('#highest-bid').text(data.highest_bid);
            $('#highest-bidder').text(data.highest_bidder_name);
            $('#time-remaining').text(data.time_remaining);
          } else {
            $('#auction-token').text('-');
            $('#highest-bid').text('0');
            $('#highest-bidder').text('-');
            $('#time-remaining').text('0');
          }
        }
      });
    }
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    setInterval(updateAuctionStatus, 2000);
    updateAuctionStatus();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞–≤–∫–∏
    $('#bid-form').on('submit', function(e){
      e.preventDefault();
      var bidUsername = $('#bid-username').val().trim();
      var bidAmount = $('#bid-amount').val();
      $.ajax({
        url: '/place_bid',
        method: 'POST',
        data: {
          bidder_id: 'web_user',  // –ï—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π ID
          bidder_name: bidUsername,
          bid_amount: bidAmount
        },
        success: function(data){
          $('#bid-message').html('<div class="alert alert-success">' + data.message + '</div>');
          $('#bid-amount').val('');
          updateAuctionStatus();
        },
        error: function(xhr){
          var response = JSON.parse(xhr.responseText);
          $('#bid-message').html('<div class="alert alert-danger">' + response.detail + '</div>');
        }
      });
    });
  </script>
</body>
</html>
