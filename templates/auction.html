<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ê—É–∫—Ü–∏–æ–Ω TTH NFT</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background: #f5f7fa;
      font-family: Arial, sans-serif;
    }
    .auction-card {
      max-width: 500px;
      margin: 50px auto;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
    }
    .timer {
      font-size: 2rem;
      font-weight: bold;
      color: #ff5722;
    }
  </style>
</head>
<body>
  <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∞—É–∫—Ü–∏–æ–Ω–∞, –ø–æ –∫–ª–∏–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div class="auction-card text-center" data-toggle="modal" data-target="#auctionDetailModal">
    <h2>–ê—É–∫—Ü–∏–æ–Ω</h2>
    <p>–¢–æ–∫–µ–Ω: <span id="auction-token">-</span></p>
    <p>–¢–µ–∫—É—â–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: <span id="highest-bid">0</span> üíé</p>
    <p>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="highest-bidder">-</span></p>
    <p>–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <span class="timer" id="time-remaining">0</span> —Å–µ–∫—É–Ω–¥</p>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞—É–∫—Ü–∏–æ–Ω–µ -->
  <div class="modal fade" id="auctionDetailModal" tabindex="-1" role="dialog" aria-labelledby="auctionDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="auctionDetailModalLabel">–î–µ—Ç–∞–ª–∏ –∞—É–∫—Ü–∏–æ–Ω–∞</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>–¢–æ–∫–µ–Ω: <span id="modal-auction-token">-</span></p>
          <p>–¢–µ–∫—É—â–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: <span id="modal-highest-bid">0</span> üíé</p>
          <p>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å: <span id="modal-highest-bidder">-</span></p>
          <p>–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–µ–º–µ–Ω–∏: <span id="modal-time-remaining">0</span> —Å–µ–∫—É–Ω–¥</p>
          <hr>
          <h6>–°–ø–∏—Å–æ–∫ —Å—Ç–∞–≤–æ–∫:</h6>
          <ul id="bid-list" class="list-group">
            <!-- –°—Ç–∞–≤–∫–∏ –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ AJAX -->
          </ul>
          <hr>
          <!-- –§–æ—Ä–º–∞ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏. –ü–æ–ª–µ –¥–ª—è –∏–º–µ–Ω–∏ —É–±—Ä–∞–Ω–æ ‚Äì –æ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
          <form id="bid-form">
            <div class="form-group">
              <label for="bid-amount">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ (üíé):</label>
              <input type="number" class="form-control" id="bid-amount" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É" required>
            </div>
            <button type="submit" class="btn btn-primary">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</button>
          </form>
          <div id="bid-message" class="mt-3"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery –∏ Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∞—É–∫—Ü–∏–æ–Ω–∞
    function updateAuctionStatus(){
      $.ajax({
        url: '/auction_status',
        method: 'GET',
        success: function(data) {
          if(data.active){
            $('#auction-token').text(data.token);
            $('#highest-bid').text(data.highest_bid);
            $('#highest-bidder').text(data.highest_bidder_name);
            $('#time-remaining').text(data.time_remaining);

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            $('#modal-auction-token').text(data.token);
            $('#modal-highest-bid').text(data.highest_bid);
            $('#modal-highest-bidder').text(data.highest_bidder_name);
            $('#modal-time-remaining').text(data.time_remaining);
          } else {
            $('#auction-token').text('-');
            $('#highest-bid').text('0');
            $('#highest-bidder').text('-');
            $('#time-remaining').text('0');
          }
        }
      });
    }
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫
    function loadBids(){
      $.ajax({
        url: '/bids',
        method: 'GET',
        success: function(data) {
          var bidList = $('#bid-list');
          bidList.empty();
          if(data.bids && data.bids.length > 0){
            data.bids.forEach(function(bid) {
              bidList.append('<li class="list-group-item">'+ bid.bidder_name +' –ø–æ—Å—Ç–∞–≤–∏–ª '+ bid.bid_amount +' üíé –≤ '+ new Date(bid.timestamp).toLocaleTimeString() +'</li>');
            });
          } else {
            bidList.append('<li class="list-group-item">–ü–æ–∫–∞ —Å—Ç–∞–≤–æ–∫ –Ω–µ—Ç.</li>');
          }
        }
      });
    }
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–≤–æ–∫ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
    setInterval(function(){
      updateAuctionStatus();
      loadBids();
    }, 2000);
    updateAuctionStatus();
    loadBids();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Ç–∞–≤–∫–∏
    $('#bid-form').on('submit', function(e){
      e.preventDefault();
      var bidAmount = $('#bid-amount').val();
      $.ajax({
        url: '/place_bid',
        method: 'POST',
        data: {
          bidder_id: 'web_user',  // –ó–¥–µ—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          bidder_name: '', // –ü–æ–ª–µ –Ω–∏–∫ —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è ‚Äì —Å–µ—Ä–≤–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ–≥–æ –ø–æ —Å–µ—Å—Å–∏–∏
          bid_amount: bidAmount
        },
        success: function(data){
          $('#bid-message').html('<div class="alert alert-success">' + data.message + '</div>');
          $('#bid-amount').val('');
          updateAuctionStatus();
          loadBids();
        },
        error: function(xhr){
          var response = JSON.parse(xhr.responseText);
          $('#bid-message').html('<div class="alert alert-danger">' + response.detail + '</div>');
        }
      });
    });
  </script>
</body>
</html>
