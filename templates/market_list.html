{% import "partials/market_macros.html" as macros %}

<div class="sort-container mb-3">
  <button id="toggle-sort" class="btn btn-secondary btn-block">
    Сортировать <span id="sort-arrow">▼</span>
  </button>
  <div id="sort-options" class="mt-2" style="display:none;">
    <div class="sort-options-rows">
      <div class="row">
        <div class="btn-group btn-group-sm" role="group">
          <button class="btn sort-btn" data-sort="token-length-asc">Меньше цифр</button>
          <button class="btn sort-btn" data-sort="repeats-desc">Больше повторов</button>
          <button class="btn sort-btn" data-sort="bg-rarity-asc">Редкие фоны</button>
        </div>
      </div>
      <div class="row mt-2">
        <div class="btn-group btn-group-sm" role="group">
          <button class="btn sort-btn" data-sort="price-asc">Цена ↓</button>
          <button class="btn sort-btn" data-sort="price-desc">Цена ↑</button>
        </div>
      </div>
    </div>
    <div class="mt-2">
      <label>Фильтр по фону:</label>
      <div id="custom-bg-filter">
        <div class="selected">
          <div class="color-circle" style="background:#fff;"></div>
          <span>Все цвета</span>
        </div>
        <ul></ul>
      </div>
    </div>
  </div>
</div>

{% if user %}
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#sale">На продаже</a></li>
    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#my">Мои</a></li>
  </ul>
  <div class="tab-content">
    <div id="sale" class="tab-pane fade show active">
      <h1 class="mb-4">Номера на продаже</h1>
      <div class="row">
        {% for l in market %}{{ macros.market_card(l, users) }}{% endfor %}
      </div>
    </div>
    <div id="my" class="tab-pane fade">
      <h1 class="mb-4">Мои номера</h1>
      <div class="row">
        {% set mine = market|selectattr('seller_id','equalto',user_id)|list %}
        {% if mine %}
          {% for l in mine %}{{ macros.market_card(l, users) }}{% endfor %}
        {% else %}
          <p class="ml-3">У вас пока нет номеров на продаже.</p>
        {% endif %}
      </div>
    </div>
  </div>
{% else %}
  <h1 class="mb-4">Номера на продаже</h1>
  <div class="row">
    {% for l in market %}{{ macros.market_card(l, users) }}{% endfor %}
  </div>
{% endif %}
