{# templates/macros.html #}

{% macro card_wrapper(token, idx) %}
<div class="col-md-4 mb-3">
  <div class="card-wrapper" data-id="{{ token.token }}">
    <div class="order-badge"></div>
    <div class="card token-card"
      {% if token.bg_is_image %}
        style="background: url('{{ token.bg_color }}') no-repeat center/cover; {% if token.bg_rarity == '0.1%' %}border:3px solid gold;{% endif %}"
      {% elif 'linear-gradient' in token.bg_color %}
        style="background: {{ token.bg_color }}; {% if token.bg_rarity == '0.1%' %}border:3px solid gold;{% endif %}"
      {% else %}
        style="background-color: {{ token.bg_color }}; {% if token.bg_rarity == '0.1%' %}border:3px solid gold;{% endif %}"
      {% endif %}
      data-toggle="modal" data-target="#tokenModal{{ idx }}">
      {% if token.overall_rarity != '–û–±—ã—á–Ω—ã–π' %}
        <div class="rarity-badge">{{ token.overall_rarity }}</div>
      {% endif %}
      <div class="card-body text-center">
        <h4 class="token-number">
          {% if 'linear-gradient' in token.text_color %}
            <span style="background: {{ token.text_color }};
                         -webkit-background-clip: text; color: transparent;">
              {{ token.token }}
            </span>
          {% else %}
            <span style="color: {{ token.text_color }};">{{ token.token }}</span>
          {% endif %}
        </h4>
      </div>
      {% if token.bg_availability %}
        <div class="token-availability">
          {{ token.bg_availability | replace("–ù–∞–ª–∏—á–∏–µ: ","") | replace("/"," –∏–∑ ") }}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}


{% macro token_modal(token, idx, is_owner, user, user_id) %}
<div class="modal fade" id="tokenModal{{ idx }}" tabindex="-1" role="dialog"
     aria-labelledby="tokenModalLabel{{ idx }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header token-details"
           {% if token.bg_is_image %}
             style="background: url('{{ token.bg_color }}') no-repeat center/cover;"
           {% elif 'linear-gradient' in token.bg_color %}
             style="background: {{ token.bg_color }};"
           {% else %}
             style="background-color: {{ token.bg_color }};"
           {% endif %}>
        <h5 class="modal-title" id="tokenModalLabel{{ idx }}">–î–µ—Ç–∞–ª–∏ –Ω–æ–º–µ—Ä–∞</h5>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <div class="token-card modal-token-card"
               {% if token.bg_is_image %}
                 style="background: url('{{ token.bg_color }}') no-repeat center/cover; {% if token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}"
               {% elif 'linear-gradient' in token.bg_color %}
                 style="background: {{ token.bg_color }}; {% if token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}"
               {% else %}
                 style="background-color: {{ token.bg_color }}; {% if token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}"
               {% endif %}>
            <h4 class="token-number">
              {% if 'linear-gradient' in token.text_color %}
                <span style="background: {{ token.text_color }};
                             -webkit-background-clip: text; color: transparent;">
                  {{ token.token }}
                </span>
              {% else %}
                <span style="color: {{ token.text_color }};">{{ token.token }}</span>
              {% endif %}
            </h4>
          </div>
        </div>
        <p><strong>–†–µ–¥–∫–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞:</strong> {{ token.number_rarity }}</p>
        <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ü–∏—Ñ—Ä:</strong> {{ token.text_rarity }}</p>
        <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞:</strong> {{ token.bg_rarity }}</p>
        {% if token.bg_availability %}
          <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong> {{ token.bg_availability }}</p>
        {% endif %}
        <p><strong>–û–±—â–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å:</strong> {{ token.overall_rarity }}</p>
        <p><strong>–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è:</strong> {{ token.timestamp }}</p>
      </div>
      <div class="modal-footer d-flex flex-column">
        {% if is_owner %}
          {% if user.custom_number and user.custom_number.token == token.token %}
            <form action="/remove_profile_token" method="post" class="w-100 mb-2">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              <button class="btn btn-warning btn-block w-100">–°–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</button>
            </form>
          {% else %}
            <form action="/set_profile_token" method="post" class="w-100 mb-2">
              <input type="hidden" name="user_id"    value="{{ user_id }}">
              <input type="hidden" name="token_index" value="{{ idx }}">
              <button class="btn btn-success btn-block w-100">–ü–æ—Å—Ç–∞–≤–∏—Ç—å –≤ –ø—Ä–æ—Ñ–∏–ª—å</button>
            </form>
          {% endif %}

          <!-- 2-–π —Ä—è–¥: —Ç–µ–ø–µ—Ä—å ‚Äî –∫–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
          <button
            type="button"
            class="btn btn-outline-success btn-block w-100 mb-2"
            data-toggle="modal"
            data-target="#confirmSwapModal{{ idx }}">
            –û–±–º–µ–Ω—è—Ç—å –Ω–∞ 49 üíé
          </button>
        {% endif %}

        <!-- 3-–π —Ä—è–¥: –ó–∞–∫—Ä—ã—Ç—å -->
        <button class="btn btn-secondary btn-block w-100"
                data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>

{# ‚Äî‚Äî‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî‚Äî‚Äî #}
{% if is_owner %}
<div class="modal fade" id="confirmSwapModal{{ idx }}" tabindex="-1" role="dialog"
     aria-labelledby="confirmSwapLabel{{ idx }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmSwapLabel{{ idx }}">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–±–º–µ–Ω</h5>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body text-center">
        –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–±–º–µ–Ω—è—Ç—å –Ω–æ–º–µ—Ä
        <strong>{{ token.token }}</strong>
        –Ω–∞ 49 üíé?
      </div>
      <div class="modal-footer d-flex flex-column">
        <form action="/swap49" method="post" class="w-100 mb-2">
          <input type="hidden" name="user_id"     value="{{ user_id }}">
          <input type="hidden" name="token_index" value="{{ idx }}">
          <button type="submit" class="btn btn-success btn-block w-100">
            –î–∞, –æ–±–º–µ–Ω—è—Ç—å
          </button>
        </form>
        <button
          type="button"
          class="btn btn-secondary btn-block w-100"
          data-dismiss="modal">
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endmacro %}
