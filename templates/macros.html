{# templates/macros.html #}

{% macro card_wrapper(token, idx) %}
<div class="col-md-4 mb-3">
  <div class="card-wrapper" data-id="{{ token.token }}">
    <div class="order-badge"></div>
    <div class="card token-card"
      {% if token.bg_is_image %}
        style="background: url('{{ token.bg_color }}') no-repeat center/cover; {% if token.bg_rarity == '0.1%' %}border:3px solid gold;{% endif %}"
      {% elif 'linear-gradient' in token.bg_color %}
        style="background: {{ token.bg_color }}; {% if token.bg_rarity == '0.1%' %}border:3px solid gold;{% endif %}"
      {% else %}
        style="background-color: {{ token.bg_color }}; {% if token.bg_rarity == '0.1%' %}border:3px solid gold;{% endif %}"
      {% endif %}
      data-toggle="modal" data-target="#tokenModal{{ idx }}">
      {% if token.overall_rarity != '–û–±—ã—á–Ω—ã–π' %}
        <div class="rarity-badge">{{ token.overall_rarity }}</div>
      {% endif %}
      <div class="card-body text-center">
        <h4 class="token-number">
          {% if 'linear-gradient' in token.text_color %}
            <span style="background: {{ token.text_color }};
                         -webkit-background-clip: text; color: transparent;">
              {{ token.token }}
            </span>
          {% else %}
            <span style="color: {{ token.text_color }};">{{ token.token }}</span>
          {% endif %}
        </h4>
      </div>
      {% if token.bg_availability %}
        <div class="token-availability">
          {{ token.bg_availability | replace("–ù–∞–ª–∏—á–∏–µ: ","") | replace("/"," –∏–∑ ") }}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}

{% macro token_modal(token, idx, is_owner, user, user_id) %}
<div class="modal fade" id="tokenModal{{ idx }}" tabindex="-1" role="dialog"
     aria-labelledby="tokenModalLabel{{ idx }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header token-details"
           {% if token.bg_is_image %}
             style="background: url('{{ token.bg_color }}') no-repeat center/cover;"
           {% elif 'linear-gradient' in token.bg_color %}
             style="background: {{ token.bg_color }};"
           {% else %}
             style="background-color: {{ token.bg_color }};"
           {% endif %}>
        <h5 class="modal-title" id="tokenModalLabel{{ idx }}">–î–µ—Ç–∞–ª–∏ –Ω–æ–º–µ—Ä–∞</h5>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>

      <div class="modal-body">
        <table class="table table-borderless">
          <tbody>
            <tr>
              <th scope="row">–ù–æ–º–µ—Ä</th>
              <td>
                {{ token.token }}
                <small class="text-muted">({{ token.number_rarity }})</small>
              </td>
            </tr>
            <tr>
              <th scope="row">–¶–∏—Ñ—Ä—ã</th>
              <td>
                {{ token.text_rarity }}
              </td>
            </tr>
            <tr>
              <th scope="row">–§–æ–Ω</th>
              <td>
                {{ token.bg_color_name or token.bg_color }}
              </td>
            </tr>
            {% if token.bg_availability %}
            <tr>
              <th scope="row">–ù–∞–ª–∏—á–∏–µ</th>
              <td>{{ token.bg_availability | replace("–ù–∞–ª–∏—á–∏–µ: ","") | replace("/"," –∏–∑ ") }}</td>
            </tr>
            {% endif %}
            <tr>
              <th scope="row">–û–±—â–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å</th>
              <td>{{ token.overall_rarity }}</td>
            </tr>
            <tr>
              <th scope="row">–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</th>
              <td>{{ token.timestamp }}</td>
            </tr>
            <tr>
              <th scope="row">–í–ª–∞–¥–µ–ª–µ—Ü</th>
              <td class="d-flex align-items-center">
                {% if users[token.seller_id].photo_url %}
                  <img src="{{ users[token.seller_id].photo_url }}"
                       class="rounded-circle mr-2" width="32" height="32">
                {% endif %}
                {{ users[token.seller_id].username or token.seller_id }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="modal-footer d-flex flex-column">
        {% if is_owner %}
          {% if user.custom_number and user.custom_number.token == token.token %}
            <form action="/remove_profile_token" method="post" class="w-100 mb-2">
              <input type="hidden" name="user_id" value="{{ user_id }}">
              <button class="btn btn-warning btn-block">–°–Ω—è—Ç—å –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä</button>
            </form>
          {% else %}
            <form action="/set_profile_token" method="post" class="w-100 mb-2">
              <input type="hidden" name="user_id"    value="{{ user_id }}">
              <input type="hidden" name="token_index" value="{{ idx }}">
              <button class="btn btn-success btn-block">–°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å–Ω—ã–º</button>
            </form>
          {% endif %}
          <button type="button"
                  class="btn btn-outline-success btn-block mb-2"
                  data-toggle="modal"
                  data-target="#confirmSwapModal{{ idx }}">
            –û–±–º–µ–Ω—è—Ç—å –Ω–∞ 49 üíé
          </button>
        {% endif %}
        <button class="btn btn-secondary btn-block" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>

{% if is_owner %}
<div class="modal fade" id="confirmSwapModal{{ idx }}" tabindex="-1" role="dialog"
     aria-labelledby="confirmSwapLabel{{ idx }}" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmSwapLabel{{ idx }}">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–±–º–µ–Ω</h5>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body text-center">
        –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ–±–º–µ–Ω—è—Ç—å –Ω–æ–º–µ—Ä
        <strong>{{ token.token }}</strong> –Ω–∞ 49 üíé?
      </div>
      <div class="modal-footer d-flex flex-column">
        <form action="/swap49" method="post" class="swap49-form w-100 mb-2">
          <input type="hidden" name="user_id"     value="{{ user_id }}">
          <input type="hidden" name="token_index" value="{{ idx }}">
          <button type="submit" class="btn btn-success btn-block">–î–∞, –æ–±–º–µ–Ω—è—Ç—å</button>
        </form>
        <button type="button"
                class="btn btn-secondary btn-block"
                data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endmacro %}
