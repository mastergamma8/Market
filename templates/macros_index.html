{# templates/macros_index.html #}

{% macro market_card(listing, users) %}
<div class="col-md-6 mb-3">
  <div class="market-card"
       data-token="{{ listing.token.token }}"
       data-token-length="{{ listing.token.token|length }}"
       data-repeats="{{ listing.token.max_repeats }}"
       data-price="{{ listing.price }}"
       data-bg-rarity="{{ listing.token.bg_rarity[:-1]|float }}"
       data-bg-color="{{ listing.token.bg_color }}"
       data-toggle="modal"
       data-target="#listingModal-{{ listing.token.token }}"
       {% if listing.token.bg_is_image %}
         style="background: url('{{ listing.token.bg_color }}') no-repeat center/cover;
                {% if listing.token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}
                color: {{ listing.token.text_color }};"
       {% else %}
         {% if 'linear-gradient' in listing.token.bg_color %}
           style="background: {{ listing.token.bg_color }}; color: {{ listing.token.text_color }};"
         {% else %}
           style="background-color: {{ listing.token.bg_color }}; color: {{ listing.token.text_color }};"
         {% endif %}
       {% endif %}>
    {% if listing.token.overall_rarity!='–û–±—ã—á–Ω—ã–π' %}
      <div class="rarity-badge">{{ listing.token.overall_rarity }}</div>
    {% endif %}
    <div class="market-number">
      {% if 'linear-gradient' in listing.token.text_color %}
        <span style="background: {{ listing.token.text_color }};
                     -webkit-background-clip: text; color: transparent;">
          {{ listing.token.token }}
        </span>
      {% else %}
        {{ listing.token.token }}
      {% endif %}
    </div>
    <div class="market-info">
      <p>–¶–µ–Ω–∞: {{ listing.price }} üíé</p>
      <p>–ü—Ä–æ–¥–∞–≤–µ—Ü: {{ users.get(listing.seller_id,{}).username or listing.seller_id }}</p>
    </div>
    {% if listing.token.bg_availability %}
      <div class="token-availability">
        {{ listing.token.bg_availability|replace("–ù–∞–ª–∏—á–∏–µ: ","")|replace("/"," –∏–∑ ") }}
      </div>
    {% endif %}
  </div>
</div>
{% endmacro %}


{% macro listing_modal(listing, users, user, user_id, buyer_id) %}
<div class="modal fade" id="listingModal-{{ listing.token.token }}" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header token-details">
        <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ –Ω–æ–º–µ—Ä–∞ {{ listing.token.token }}</h5>
        <button class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <div class="modal-token-card"
               {% if listing.token.bg_is_image %}
                 style="background: url('{{ listing.token.bg_color }}') no-repeat center/cover;
                        {% if listing.token.bg_rarity=='0.1%' %}border:3px solid gold;{% endif %}
                        color: {{ listing.token.text_color }};"
               {% else %}
                 {% if 'linear-gradient' in listing.token.bg_color %}
                   style="background: {{ listing.token.bg_color }}; color: {{ listing.token.text_color }};"
                 {% else %}
                   style="background-color: {{ listing.token.bg_color }}; color: {{ listing.token.text_color }};"
                 {% endif %}
               {% endif %}>
            <h4 class="market-number">{{ listing.token.token }}</h4>
          </div>
        </div>
        <p><strong>–†–µ–¥–∫–æ—Å—Ç—å –Ω–æ–º–µ—Ä–∞:</strong> {{ listing.token.number_rarity }}</p>
        <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ü–∏—Ñ—Ä:</strong> {{ listing.token.text_rarity }}</p>
        <p><strong>–†–µ–¥–∫–æ—Å—Ç—å —Ñ–æ–Ω–∞:</strong> {{ listing.token.bg_rarity }}</p>
        <p><strong>–û–±—â–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å:</strong> {{ listing.token.overall_rarity }}</p>
        <p><strong>–¶–µ–Ω–∞:</strong> {{ listing.price }} üíé</p>
        <p><strong>–ü—Ä–æ–¥–∞–≤–µ—Ü:</strong> {{ users.get(listing.seller_id,{}).username or listing.seller_id }}</p>
        {% if listing.token.bg_availability %}
          <p><strong>–ù–∞–ª–∏—á–∏–µ:</strong> {{ listing.token.bg_availability|replace("–ù–∞–ª–∏—á–∏–µ: ","")|replace("/"," –∏–∑ ") }}</p>
        {% endif %}
      </div>
      <div class="modal-footer">
        {% if user and user_id==listing.seller_id %}
          <button class="btn btn-warning mr-2" data-toggle="modal" data-target="#updatePriceModal-{{ listing.token.token }}">–ò–∑–º. —Ü–µ–Ω—É</button>
          <form action="/withdraw" method="post" class="d-inline">
            <input type="hidden" name="market_index" value="{{ listing.token.token }}">
            <button class="btn btn-danger">–°–Ω—è—Ç—å —Å –ø—Ä–æ–¥–∞–∂–∏</button>
          </form>
        {% else %}
          <form action="/buy/{{ listing.token.token }}" method="post" class="d-inline">
            {% if buyer_id %}<input type="hidden" name="buyer_id" value="{{ buyer_id }}">{% endif %}
            <button class="btn btn-primary">–ö—É–ø–∏—Ç—å</button>
          </form>
          <button class="btn btn-info ml-2" data-toggle="modal" data-target="#offerModal-{{ listing.token.token }}">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å</button>
        {% endif %}
        <button class="btn btn-secondary" data-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>
</div>
{% endmacro %}
